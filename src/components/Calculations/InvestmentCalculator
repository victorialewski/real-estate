import React, { useState } from "react";
import "./SowRight.css";
import "../Form.css";

export default function SowRight({
    total,
    arvInput,
    setArvInput,
    rehab,
    purchasePriceInput,
    setPurchasePriceInput,
    downPaymentInput,
    setDownPaymentInput,
    formatCurrency,
    setRehab,
    avgPrice,
    setAvgPrice,
    avgSalePrice,
    setAvgSalePrice
}) {

    const [inputPercentage, setInputPercentage] = useState(""); // Percentage input by user
    const [remainingDecimal, setRemainingDecimal] = useState(""); // Remaining percentage for calculation
    const [percentage, setPercentage] = useState(0.7); // Default to 70%

    // Calculate realtor fees (2% of ARV)
    const realtorTotal = arvInput || avgSalePrice ? formatCurrency(Number(arvInput || avgSalePrice) * 0.02) : formatCurrency(0);

    // Calculate investment sum (purchase price, rehab, down payment, total)
    const investment = formatCurrency(Number(rehab) + Number(purchasePriceInput) + Number(downPaymentInput) + Number(total));

    // Calculate sale investment including realtor fees
    const saleInvestment = arvInput || avgSalePrice  ? formatCurrency(Number(arvInput || avgSalePrice) + Number(realtorTotal.replace(/[^0-9.-]+/g, ''))) : formatCurrency(0);

    // Calculate grand total (profit/loss after subtracting investment)
    const grandTotal = formatCurrency(Number(saleInvestment.replace(/[^0-9.-]+/g, '')) - Number(investment.replace(/[^0-9.-]+/g, '')));



    // const adjustmentPrice = maxARV - arvInput || avgSalePrice;




    // Convert input percentage to decimal and calculate the remaining percentage
    const convertDecimal = (value) => {
        setInputPercentage(value);

        const percentageValue = value ? Number(value) / 100 : 0.7; // Default to 70% if no input
        const remainingPercentage = 1 - percentageValue;

        setPercentage(percentageValue);
        setRemainingDecimal(remainingPercentage);
    };

    const calculateMaxARV = (arv, inputPercentage) => {
        const percentageValue = inputPercentage ? Number(inputPercentage) / 100 : 0.7; // Default to 70% if no input
        const maxARVValue = arv ? Number(arv) * percentageValue : 0;
        return formatCurrency(maxARVValue); // Return formatted max ARV
    };
    
    const calculateRemainingPercentage = (inputPercentage) => {
        const remaining = 100 - (inputPercentage || 70); // Default to 70% if no input
        return remaining; // Return remaining percentage
    };
    
    // // Inside your component JSX:
    const maxARV = calculateMaxARV(arvInput || avgSalePrice, inputPercentage);
    const remainingPercentage = calculateRemainingPercentage(inputPercentage);
    // const adjustmentPrice = arvInput || avgSalePrice ? formatCurrency(Number(arvInput || avgSalePrice) - Number(maxARV)) : formatCurrency(0);

    const rawARV = Number(arvInput || avgSalePrice);
    const rawMaxARV = Number(String(maxARV).replace(/[^0-9.-]+/g, ""));
    const adjustmentPrice = arvInput || avgSalePrice
      ? formatCurrency(rawARV - rawMaxARV)
      : formatCurrency(0);

    // Handle down payment input change
    const handleDownPaymentChange = (e) => {
        const raw = e.target.value.replace(/[^0-9.]/g, ""); // Remove non-numeric except dot
        setDownPaymentInput(raw);
    };

    return (
        <div className="Right calculations top-6">
            <div className="Right-calculations">
                <div className="TotalLeft">
                    <div className="input-calculations">
                        <div className="TotalLeft-container">

                                           {/* Purchase Price Input */}
                                           <div className="input-group-container">
                                <div className="input-group">
                                    <label className="block mb-1 text-sm font-medium text-gray-700">Enter Purchase Price:</label>
                                    <input
                                        type="number"
                                        className="w-full p-2 border rounded profitForm"
                                        value={purchasePriceInput}
                                        onChange={(e) => setPurchasePriceInput(e.target.value)}
                                        placeholder="Purchase Price..."
                                    />
                                </div>
                            </div>

                            {/* Down Payment Input */}
                            <div className="input-group-container">
                                <div className="input-group">
                                    <label className="block mb-1 text-sm font-medium text-gray-700">Enter Down Payment:</label>
                                    <input
                                        type="number"
                                        className="w-full p-2 border rounded profitForm"
                                        value={downPaymentInput}
                                        onChange={handleDownPaymentChange}
                                        placeholder="Down Payment..."
                                    />
                                </div>
                            </div>

                            {/* Rehab Input */}
                            <div className="input-group-container">
                                <div className="input-group">
                                    <label className="block mb-1 text-sm font-medium text-gray-700">Rehab:</label>
                                    <input
                                        type="number"
                                        className="w-full p-2 border rounded profitForm"
                                        value={rehab}
                                        onChange={(e) => setRehab(e.target.value)}
                                        placeholder="Rehab..."
                                    />
                                </div>
                            </div>
                            
                            {/* ARV Input */}
                            <div className="input-group-container">
                                <div className="input-group">
                                    <label htmlFor="arv">Enter ARV:</label>
                                    <input
                                        type="number"
                                        id="arv"
                                        className="w-full p-2 border rounded profitForm"
                                        value={arvInput}
                                        onChange={(e) => setArvInput(e.target.value)}
                                        placeholder="ARV..."
                                    />
                                </div>
                            </div>

                            {/* ARV Percentage Input */}
                            <div className="calculator-container">
                                <h2>ARV</h2>
                                <div className="input-group">
                                    <label htmlFor="inputPercentage">Enter a percentage:</label>
                                    <input
                                        type="number"
                                        id="inputPercentage"
                                        className="w-full p-2 border rounded profitForm"
                                        value={inputPercentage}
                                        onChange={(e) => convertDecimal(e.target.value)}
                                        placeholder="Enter a percentage"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Totals */}

                <div className="Total-Right mt-6">
                    <div className="calculation-container">
                    <div className="calculation-card">

                        <div className="tooltip-container">
                            <div className="amount-title">Purchase Price:</div>
                            <div className="amount-container">{formatCurrency(purchasePriceInput || 0)}</div>
                            <span className="tooltip-box">The agreed property purchase price</span>
                        </div>

                        <div className="tooltip-container">
                            <div className="amount-title">Down Payment:</div>
                            <div className="amount-container">{formatCurrency(downPaymentInput || 0)}</div>
                            <span className="tooltip-box">The amount you plan to put down initially</span>
                        </div>

                        <div className="tooltip-container">
                            <span className="amount-title">Rehab Total:</span>
                            <span className="amount-container">{formatCurrency(total || rehab)}</span>
                            <span className="tooltip-box">Sum of all estimated repair and renovation costs</span>
                        </div>

                        <div className="tooltip-container">
                            <span className="amount-title">Realtor Fees:</span>
                            <span className="amount-container">{realtorTotal}</span>
                            <span className="tooltip-box">Estimated 2% of ARV paid to real estate agents</span>
                        </div>

                        <div className="tooltip-container">
                            <span className="amount-title">ARV:</span>
                            <span className="amount-container">{formatCurrency(arvInput || avgSalePrice)}</span>
                            <span className="tooltip-box">After Repair Valueâ€”expected resale price</span>
                        </div>

                        <div className="tooltip-container">
                            <div className="amount-title">ARV + Realtor:</div>
                            <div className="amount-container">{saleInvestment}</div>
                            <span className="tooltip-box">Expected sale value including realtor fees</span>
                        </div>

                        <div className="tooltip-container">
                            <div className="amount-title">Investment:</div>
                            <div className="amount-container">{investment}</div>
                            <span className="tooltip-box">Total money spent (purchase, rehab, down payment)</span>
                        </div>

                        <div className="tooltip-container profit-amt">
                            <div className="amount-title">Grand Total:</div>
                            <div className="amount-container">{grandTotal}</div>
                            <span className="tooltip-box">Profit or loss after selling and subtracting investment</span>
                        </div>
                        </div>
                        <div className="calculation-card">
                        <div >

                        <div className="tooltip-container">
                            <div className="amount-title">Calculated ARV:</div>
                            <div className="amount-container">{formatCurrency(arvInput || avgSalePrice)}</div>
                            <span className="tooltip-box">Profit or loss after selling and subtracting investment</span>
                        </div>

                        <div className="tooltip-container">
                            <div className="amount-title">MAX Offer: {inputPercentage || 70}%</div>
                            <div className="amount-container">{maxARV}</div>
                            <span className="tooltip-box">Maximum ARV after considering the input percentage</span>
                        </div>
                        <div className="tooltip-container">
                            <div className="amount-title">Remaining {remainingPercentage}%</div>
                            <div className="amount-container">{ adjustmentPrice}</div>
                            <span className="tooltip-box">Maximum ARV after considering the input percentage</span>
                        </div>
                        {/* <div className="tooltip-container">
                            <div className="amount-title">Ratio</div>
                            <div className="amount-container">{inputPercentage || 70}/{remainingPercentage}</div>
                            <span className="tooltip-box">Maximum ARV after considering the input percentage</span>
                        </div> */}
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}
